<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />
  <script src="//code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
  <script>
    $(function(){
      var url = window.location.origin + '/booking/<%= booking.objectId%>';
      $('.ui.dropdown')
      .dropdown({
        action: 'select',
        onChange: function(value, selectedItem) {
          var putData;
          $(selectedItem).parent().parent().find('div.text').text(value);
          if (value === '拒絕') {
            putData = { state: 'reject' };
          } else if (value === '通過') {
            putData = { state: 'approved', approvedDate: new Date() };
          }
          $.ajax(url, {
            method: 'PUT',
            data: putData,
            success: function(data) {
              console.log(data);
            },
          });
        }
      });
    });
  </script>
  <style>
    #title {
      margin-top: 10px;
      margin-bottom: 10px;
    }
    #status {
      border-radius: 0px;
      padding-left: 10px;
      padding-right: 10px;
      font-size: 0.83em;
    }
    #status td {
      padding-left: 3px;
      padding-right: 3px;
    }
  </style>
</head>

<body>
  <h2 id="title" class="ui horizontal divider header">
    報備單
  </h2>
  <table id="status" class="ui very basic unstackable inverted blue table">
    <tbody>
      <tr>
        <td class="three wide">報備編號：</td>
        <td class="wide">B106390088-D062</td>
        <td class="three wide">報備日期：</td>
        <td class="wide">2017/10/10</td>
      </tr>
      <tr>
        <td class="wide">報備狀態：</td>
        <td class="wide">
          <div class="content">
            <div class="ui inline dropdown">
              <div class="text"><%= booking.state %></div>
              <i class="dropdown icon"></i>
              <div class="menu">
                <div class="item" data-text="通過">通過</div>
                <div class="item" data-text="拒絕">拒絕</div>
              </div>
            </div>
          </div>
        </td>
        <td class="wide">通過日期：</td>
        <td class="wide"><%= booking.approvedDate %></td>
      </tr>
      <tr>
        <td class="wide">紅利狀態：</td>
        <td class="wide">
            <div class="content">
                <div class="ui inline dropdown">
                  <div class="text">未指定</div>
                  <i class="dropdown icon"></i>
                  <div class="menu">
                    <div class="active item" data-text="today">未指定</div>
                    <div class="item" data-text="this week">未指定</div>
                    <div class="item" data-text="this month">未指定</div>
                  </div>
                </div>
              </div>          
        </td>
        <td class="wide">審核日期：</td>
        <td class="wide"></td>
      </tr>
      <tr>
        <td class="wide">申請試用：</td>
        <td class="wide">
          <div class="content">
            <div class="ui inline dropdown">
              <div class="text">未指定</div>
              <i class="dropdown icon"></i>
              <div class="menu">
                <div class="active item" data-text="today">未指定</div>
                <div class="item" data-text="this week">未指定</div>
                <div class="item" data-text="this month">未指定</div>
              </div>
            </div>
          </div>          
        </td>
        <td class="wide">試用狀態：</td>
        <td class="wide">
          <div class="content">
            <div class="ui inline dropdown">
              <div class="text">未指定</div>
              <i class="dropdown icon"></i>
              <div class="menu">
                <div class="active item" data-text="today">未指定</div>
                <div class="item" data-text="this week">未指定</div>
                <div class="item" data-text="this month">未指定</div>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="ui container">
    <table id="content" class="ui very basic fixed unstackable table">
      <tbody>
        <tr>
          <td>行銷機會名稱</td>
          <td class="right aligned"><%= `${booking.company.name}_${booking.productCategory}` %></td>
        </tr>
        <tr>
          <td>客戶公司名稱</td>
          <td class="right aligned"><%= booking.company.name %></td>
        </tr>
        <tr>
          <td>客戶地址</td>
          <td class="right aligned"><%= booking.company.address %></td>
        </tr>
        <tr>
          <td>客戶聯絡人</td>
          <td class="right aligned"><%= user.name %></td>
        </tr>
        <tr>
          <td>客戶電話</td>
          <td class="right aligned"><%= user.phone %></td>
        </tr>
        <tr>
          <td>客戶 Email</td>
          <td class="right aligned"><%= user.email %></td>
        </tr>
        <tr>
          <td>
            <div class="ui list">
                <div class="item">報備規格數量</div>
                <div class="item">
                  <% booking.productBookingIds.forEach(function(e){ %>
                    <div class="ui two column grid">
                        <div class="column"><%= e.product.PdName %></div>
                        <div class="column"><%= e.amount %></div>
                    </div>                        
                  <% }) %>
                </div>
              </div>
          </td>
          <td></td>
        </tr>
        <tr>
          <td>預計結案日</td>
          <td class="right aligned"><%= booking.closeDate %></td>
        </tr>
      </tbody>
    </table>

  </div>

</body>

</html>
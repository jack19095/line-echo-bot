<%
if (typeof title === 'undefined') {
  var title = '總覽'
}
if (typeof plugin === 'undefined') {
  var plugin = ''
}
if (typeof userId === 'undefined') {
  var userId = ''
}
%>
<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />
  <script src="//code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
  <style>
    #title {
      margin-top: 10px;
      margin-bottom: 10px;
    }

    #status {
      border-radius: 0px;
      padding-left: 10px;
      padding-right: 10px;
      font-size: 0.9em;
    }
  </style>
  <script>
    $(function () {
      var url = window.location.origin + '/user/';
      $('i.check.circle.icon').click(function () {
        var objectId = $(this).attr('value');
        $.post(url + objectId, { state: 'approval' }, function (data) {
          console.log(objectId, data);
          window.location.reload();
        })
      })
      $('i.remove.circle.icon').click(function () {
        var objectId = $(this).attr('value');
        $.post(url + objectId, { state: 'reject' }, function (data) {
          console.log(objectId, data);
          window.location.reload();
        })
      })
    });
  </script>
</head>

<body>
  <h2 id="title" class="ui horizontal divider header">
    <%= title %>
  </h2>
  <div class="ui container">
    <table id="content" class="ui very basic unstackable small table">
      <thead>
        <tr>
          <% for (let title of titles) { %>
            <th class="collapsing">
              <%= title %>
            </th>
          <% } %>
          <% if (plugin === 'review') { %>
            <th>准許</th>
            <th>駁回</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% for (let item of data) { %>
          <tr>
            <% for (let key of keys) { %>
              <td class="collapsing">
                <% if (plugin === 'bookingReview' && key === 'state') { %>
                  <a href="/booking/edit/<%= `${item['objectId']}?userId=${userId}` %>"><%= item[key] %></a>
                <% } else { %>
                  <%= item[key] %>
                <% } %>
              </td>
            <% } %>
            <% if (plugin === 'review') { %>
              <td class="center aligned">
                <i class="check circle icon" value="<%= item['objectId'] %>">
                </i>
              </td>
              <td class="center aligned">
                <i class="remove circle icon" value="<%= item['objectId'] %>">
                </i>
              </td>
            <% } %>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</body>

</html>